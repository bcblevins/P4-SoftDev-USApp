{% extends "base.html" %}

{% block content %}
<style>

    main {
        margin-inline: 20vw;
    }
    form {
        display: flex;
        gap: 10px;
        margin-top: 10px;
        justify-content: center ;
    }
    h1, h2 {
        text-align: center;
        
    }
    h2 {
        margin-top: 30px;
    }
</style>
<main>
    <h1>
        {% if is_self %}
            Your Profile
        {% else %}
            {% with profile_user.full_name as name %}
                {% if name|slice:"-1:" == "s" %}
                    {{ name }}' Profile
                {% else %}
                    {{ name }}'s Profile
                {% endif %}
            {% endwith %}
        {% endif %}
    </h1>

    <div class="container">
        <p><strong>Name:</strong> {{ profile_user.full_name }}</p>
        {% if is_self %}
            <p><strong>Email:</strong> {{ profile_user.email }}</p>
        {% endif %}
    </div>


    <!-- Follow button (only when viewing someone else's profile) -->
    {% if not is_self %}
        <form action="{% url 'follow' profile_user.id %}" method="post" style="margin:10px 0;">
            {% csrf_token %}
            <button class="btn" type="submit">Follow {{ profile_user.full_name }}</button>
        </form>
    {% endif %}

    <hr>

    <!-- Following list -->
    {% with profile_user.full_name as name %}
    <h2>
        {% if is_self %}
            Following
        {% else %}
            {{ name }} is following
        {% endif %}
    </h2>
    {% endwith %}
    <div class="container">
        {% if following %}
            <ul>
                {% for u in following %}
                    <li>
                        {{ u.full_name }} (@{{ u.username }})
                        {% if is_self %}
                            <form action="{% url 'unfollow' u.id %}" method="post" style="display:inline;">
                                {% csrf_token %}
                                <button class="btn" type="submit">Unfollow</button>
                            </form>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>{% if is_self %}You are not following anyone yet.{% else %}This user is not following anyone.{% endif %}</p>
        {% endif %}
    </div>

    <!-- Followers list -->
    {% with profile_user.full_name as name %}
    <h2>
        {% if is_self %}
            Followers
        {% else %}
            {% if name|slice:"-1:" == "s" %}
                {{ name }}' followers
            {% else %}
                {{ name }}'s followers
            {% endif %}
        {% endif %}
    </h2>
    {% endwith %}
    <div class="container">
        {% if followers %}
            <ul>
                {% for u in followers %}
                    <li>{{ u.full_name }} (@{{ u.username }})</li>
                {% endfor %}
            </ul>
        {% else %}
            <p>{% if is_self %}No one is following you yet.{% else %}No one is following this user yet.{% endif %}</p>
        {% endif %}
    </div>

    <!-- User search (only on own profile) -->
    {% if is_self %}
        <hr>
        <h2>Find Users to Follow</h2>
        <form action="{% url 'search_users' %}" method="get">
            <input type="text" name="q" placeholder="Search by name...">
        </form>
    {% endif %}

    <hr>

    <!-- Reviews (newest first) -->
    {% with profile_user.full_name as name %}
    <h2>
        {% if is_self %}
            Reviews
        {% else %}
            {% if name|slice:"-1:" == "s" %}
                {{ name }}' reviews
            {% else %}
                {{ name }}'s reviews
            {% endif %}
        {% endif %}
    </h2>
    {% endwith %}
    {% if reviews %}
        <ul>
            {% for review in reviews %}
                <li>
                    {% include "components/review.html" with review=review is_self=is_self %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>{% if is_self %}You have not written any reviews yet.{% else %}This user has not written any reviews yet.{% endif %}</p>
    {% endif %}
</main>
{% endblock %}